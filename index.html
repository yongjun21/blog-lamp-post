<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Lamp Posts</title>
    <link rel="stylesheet" href="lib/plottable.css">
    <style>
      @import "lib/datagovsg-charts.css";

      body {
        font-family: sans-serif;
      }

      section {
        margin: 100px 0;
      }

      h2 {
        text-align: center;
      }

      #map, #chart {
        height: 500px;
        width: 900px;
        margin: auto;
      }
    </style>
  </head>
  <body>
    <section>
      <div id="map"></div>
    </section>
    <section>
      <h2>Histogram of Lamp Post Distance to Nearest Neighbour</h2>
      <svg id="chart"></svg>
    </section>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCjqDojkROjJTFkXw4PCvAS_tQTEHpgjdc"></script>
    <script src="lib/d3.min.js"></script>
    <script src="lib/plottable.min.js"></script>
    <script type="module">
      import mapStyle from './mapStyle.js'
      import {DatagovsgSimpleBar} from './lib/datagovsg-charts.min.js'

      const map = new google.maps.Map(document.getElementById('map'), {
        center: new google.maps.LatLng(1.352083, 103.819836),
        zoom: 12,
        styles: mapStyle
      })

      map.data.setStyle({
        icon: {
          path: google.maps.SymbolPath.CIRCLE,
          scale: 2,
          fillColor: 'yellow',
          fillOpacity: 0.8,
          strokeColor: 'yellow',
          strokeOpacity: 0,
          strokeWeight: 0
        },
        strokeWeight: 1
      })

      const roadId = 'ZZZ90A'

      map.data.loadGeoJson(`data/road/${roadId}.json`)
      map.data.loadGeoJson(`data/lampPost/${roadId}.json`)

      window.fetch(`data/histogram/${roadId}.json`).then(res => res.json())
        .then(histogram => {
          const series = []
          for (let i = 0; i < 50; i++) {
            series.push({label: i + 1, value: histogram[i + 1] || 0})
          }
          const chart = new DatagovsgSimpleBar({
            data: series,
            xLabel: 'Meters',
            yLabel: 'Frequency'
          })
          chart.mount(document.getElementById('chart'))
        })
    </script>
  </body>
</html>
